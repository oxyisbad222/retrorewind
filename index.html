<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Retro Rewind™ - Experience Gaming History</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f5ff;
            --neon-pink: #ff0080;
            --neon-green: #39ff14;
            --neon-purple: #bf00ff;
            --dark-bg: #0a0a0f;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Orbitron', 'Press Start 2P', cursive;
            background: var(--dark-bg);
            color: #e0e0e0;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            position: relative;
            min-height: 100vh;
        }

        /* Animated Background */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: linear-gradient(45deg, #0a0a0f 0%, #1a0a2e 50%, #16213e 100%);
        }

        .animated-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(0, 245, 255, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(255, 0, 128, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 40%, rgba(191, 0, 255, 0.08) 0%, transparent 50%);
            animation: bgPulse 8s ease-in-out infinite alternate;
        }

        @keyframes bgPulse {
            0% { opacity: 0.3; }
            100% { opacity: 0.7; }
        }

        /* Floating Particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: var(--neon-blue);
            border-radius: 50%;
            animation: float 6s linear infinite;
            opacity: 0;
        }

        .particle:nth-child(2n) { background: var(--neon-pink); animation-duration: 8s; }
        .particle:nth-child(3n) { background: var(--neon-green); animation-duration: 10s; }
        .particle:nth-child(4n) { background: var(--neon-purple); animation-duration: 7s; }

        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Glassmorphism Elements */
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            transition: all 0.3s ease;
        }

        .glass-card:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(0, 245, 255, 0.3);
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 245, 255, 0.1);
        }

        /* Enhanced Title */
        .retro-title {
            font-family: 'Orbitron', cursive;
            font-weight: 900;
            font-size: clamp(2.5rem, 8vw, 5rem);
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink), var(--neon-green));
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradientShift 3s ease-in-out infinite, titleGlow 2s ease-in-out infinite alternate;
            text-shadow: 0 0 30px rgba(0, 245, 255, 0.5);
            letter-spacing: 0.1em;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        @keyframes titleGlow {
            0% { 
                filter: drop-shadow(0 0 20px rgba(0, 245, 255, 0.5));
            }
            100% { 
                filter: drop-shadow(0 0 40px rgba(0, 245, 255, 0.8)) drop-shadow(0 0 60px rgba(255, 0, 128, 0.3));
            }
        }

        /* Enhanced Tabs */
        .tab-container {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            padding: 8px;
            display: flex;
            gap: 4px;
        }

        .tab-btn {
            font-family: 'Orbitron', cursive;
            font-weight: 700;
            padding: 12px 24px;
            border-radius: 20px;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .tab-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .tab-btn:hover::before {
            left: 100%;
        }

        .tab-btn.active {
            background: linear-gradient(45deg, rgba(0, 245, 255, 0.2), rgba(255, 0, 128, 0.2));
            color: white;
            box-shadow: 0 0 30px rgba(0, 245, 255, 0.3), inset 0 0 20px rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 245, 255, 0.3);
        }

        /* Enhanced CRT TV */
        .tv-container {
            position: relative;
            width: 100%;
            max-width: 900px;
            margin: 0 auto;
            perspective: 1000px;
        }

        .tv-frame {
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border-radius: 30px;
            padding: 40px;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.5),
                inset 0 0 50px rgba(0, 245, 255, 0.1),
                0 0 100px rgba(0, 245, 255, 0.2);
            border: 2px solid rgba(0, 245, 255, 0.3);
            position: relative;
            transform-style: preserve-3d;
        }

        .tv-frame::before {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink), var(--neon-green), var(--neon-purple));
            border-radius: 35px;
            z-index: -1;
            opacity: 0.3;
            animation: framePulse 4s ease-in-out infinite;
        }

        @keyframes framePulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        .screen-bezel {
            background: #000;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 
                inset 0 0 50px rgba(0, 0, 0, 0.8),
                0 0 30px rgba(0, 245, 255, 0.2);
            position: relative;
            overflow: hidden;
        }

        .screen-display {
            position: relative;
            width: 100%;
            padding-top: 75%;
            background: #000;
            border-radius: 15px;
            overflow: hidden;
        }

        .game-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            image-rendering: pixelated;
            z-index: 1;
        }

        .screen-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            z-index: 2;
            transition: opacity 0.5s ease;
        }

        /* Enhanced CRT Effects */
        .crt-effects {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 3;
        }

        .crt-effects::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                repeating-linear-gradient(
                    0deg,
                    rgba(0, 255, 0, 0.03) 0px,
                    rgba(0, 255, 0, 0.03) 1px,
                    transparent 1px,
                    transparent 2px
                );
            animation: scanlines 0.1s linear infinite;
        }

        .crt-effects::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, transparent 40%, rgba(0, 0, 0, 0.3) 100%);
            mix-blend-mode: multiply;
        }

        @keyframes scanlines {
            0% { transform: translateY(0); }
            100% { transform: translateY(2px); }
        }

        /* Power System */
        .power-system {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .power-indicator {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #333;
            border: 2px solid #555;
            box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }

        .power-indicator.on {
            background: radial-gradient(circle, var(--neon-green), #00cc00);
            border-color: var(--neon-green);
            box-shadow: 
                0 0 20px var(--neon-green),
                0 0 40px rgba(57, 255, 20, 0.3),
                inset 0 0 10px rgba(255, 255, 255, 0.2);
            animation: powerPulse 2s ease-in-out infinite;
        }

        @keyframes powerPulse {
            0%, 100% { 
                box-shadow: 
                    0 0 20px var(--neon-green),
                    0 0 40px rgba(57, 255, 20, 0.3),
                    inset 0 0 10px rgba(255, 255, 255, 0.2);
            }
            50% { 
                box-shadow: 
                    0 0 30px var(--neon-green),
                    0 0 60px rgba(57, 255, 20, 0.5),
                    inset 0 0 15px rgba(255, 255, 255, 0.3);
            }
        }

        .power-button {
            background: linear-gradient(145deg, #333, #222);
            border: none;
            border-radius: 15px;
            padding: 15px 30px;
            color: white;
            font-family: 'Orbitron', cursive;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .power-button:hover {
            background: linear-gradient(145deg, #444, #333);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .power-button.active {
            background: linear-gradient(145deg, var(--neon-green), #00cc00);
            box-shadow: 0 0 30px rgba(57, 255, 20, 0.5);
        }

        /* Game Library */
        .game-library {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            margin-top: 40px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .library-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(0, 245, 255, 0.3);
        }

        .library-title {
            font-family: 'Orbitron', cursive;
            font-weight: 700;
            font-size: 2rem;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Game Cartridges */
        .cartridge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 25px;
            padding: 20px 0;
        }

        .cartridge-item {
            position: relative;
            cursor: pointer;
            transition: all 0.4s ease;
            transform-style: preserve-3d;
        }

        .cartridge-item:hover {
            transform: translateY(-10px) rotateY(5deg) scale(1.05);
        }

        .cartridge-wrapper {
            position: relative;
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border-radius: 15px;
            padding: 20px;
            border: 2px solid transparent;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.4s ease;
        }

        .cartridge-item:hover .cartridge-wrapper {
            border-color: var(--neon-blue);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(0, 245, 255, 0.3);
            background: linear-gradient(145deg, #333, #222);
        }

        .cartridge-item.selected .cartridge-wrapper {
            border-color: var(--neon-pink);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(255, 0, 128, 0.5);
            background: linear-gradient(145deg, rgba(255, 0, 128, 0.1), rgba(0, 245, 255, 0.1));
        }

        .cartridge-image {
            width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 15px;
            filter: brightness(0.9);
            transition: filter 0.3s ease;
        }

        .cartridge-item:hover .cartridge-image {
            filter: brightness(1.1);
        }

        .game-cover {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 70%;
            height: 50%;
            object-fit: contain;
            border-radius: 8px;
            z-index: 2;
        }

        .cartridge-title {
            text-align: center;
            font-family: 'Orbitron', cursive;
            font-weight: 700;
            font-size: 0.9rem;
            color: white;
            margin-top: 10px;
            text-shadow: 0 0 10px rgba(0, 245, 255, 0.5);
        }

        /* Status Display */
        .status-display {
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px 25px;
            margin: 20px 0;
            border: 1px solid rgba(0, 245, 255, 0.3);
            text-align: center;
            font-family: 'Orbitron', cursive;
            font-weight: 700;
        }

        .status-text {
            color: var(--neon-blue);
            text-shadow: 0 0 10px rgba(0, 245, 255, 0.5);
            animation: statusGlow 2s ease-in-out infinite alternate;
        }

        @keyframes statusGlow {
            0% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 50%;
            border-top-color: var(--neon-blue);
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mobile Controller */
        .mobile-controller {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 250px;
            background: linear-gradient(180deg, rgba(10, 10, 15, 0.95), rgba(0, 0, 0, 0.98));
            backdrop-filter: blur(20px);
            border-top: 2px solid rgba(0, 245, 255, 0.3);
            z-index: 100;
            display: none;
            padding: 20px;
        }

        .controller-layout {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 600px;
            margin: 0 auto;
        }

        .d-pad, .face-buttons {
            display: flex;
            position: relative;
        }

        .d-pad {
            width: 120px;
            height: 120px;
            flex-direction: column;
        }

        .d-pad-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, #333, #222);
            border-radius: 8px;
            border: 2px solid #555;
        }

        .control-btn {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.05));
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 12px;
            color: white;
            font-family: 'Orbitron', cursive;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:active {
            background: linear-gradient(145deg, var(--neon-blue), rgba(0, 245, 255, 0.7));
            box-shadow: 
                0 0 20px var(--neon-blue),
                inset 0 0 20px rgba(255, 255, 255, 0.2);
            transform: scale(0.95);
        }

        .d-pad-btn {
            position: absolute;
            width: 40px;
            height: 40px;
        }

        .d-pad-up { top: 0; left: 40px; border-radius: 12px 12px 4px 4px; }
        .d-pad-down { bottom: 0; left: 40px; border-radius: 4px 4px 12px 12px; }
        .d-pad-left { top: 40px; left: 0; border-radius: 12px 4px 4px 12px; }
        .d-pad-right { top: 40px; right: 0; border-radius: 4px 12px 12px 4px; }

        .face-buttons {
            gap: 20px;
            align-items: center;
        }

        .face-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            font-size: 1.2rem;
        }

        .system-buttons {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
        }

        .system-btn {
            width: 80px;
            height: 30px;
            border-radius: 15px;
            font-size: 0.8rem;
        }

        /* Credits Section */
        .credits-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .credits-card {
            background: linear-gradient(145deg, rgba(0, 0, 0, 0.3), rgba(0, 0, 0, 0.1));
            backdrop-filter: blur(20px);
            border: 2px solid rgba(0, 245, 255, 0.3);
            border-radius: 25px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .credits-title {
            font-family: 'Orbitron', cursive;
            font-weight: 900;
            font-size: 2.5rem;
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-pink), var(--neon-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 30px;
            animation: titleGlow 2s ease-in-out infinite alternate;
        }

        .credits-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 30px 0;
        }

        .credit-item {
            background: rgba(0, 245, 255, 0.1);
            border: 1px solid rgba(0, 245, 255, 0.3);
            border-radius: 15px;
            padding: 15px 25px;
            font-family: 'Orbitron', cursive;
            font-weight: 700;
            transition: all 0.3s ease;
        }

        .credit-item:hover {
            background: rgba(0, 245, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 245, 255, 0.2);
        }

        .credits-heart {
            font-size: 3rem;
            color: var(--neon-pink);
            animation: heartBeat 1.5s ease-in-out infinite;
            margin: 20px 0;
        }

        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .tv-frame { padding: 20px; }
            .cartridge-grid { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; }
            .library-title { font-size: 1.5rem; }
            .mobile-controller { display: flex; }
            body.controller-enabled .mobile-controller { display: flex; }
        }

        @media (max-width: 480px) {
            .retro-title { font-size: 2rem; }
            .tv-frame { padding: 15px; }
            .game-library { padding: 20px; }
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Error Modal */
        .error-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 200;
        }

        .error-content {
            background: linear-gradient(145deg, rgba(40, 40, 40, 0.9), rgba(20, 20, 20, 0.9));
            backdrop-filter: blur(20px);
            border: 2px solid rgba(255, 0, 128, 0.5);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }

        .error-title {
            color: var(--neon-pink);
            font-family: 'Orbitron', cursive;
            font-weight: 700;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .error-message {
            color: white;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .error-btn {
            background: linear-gradient(145deg, var(--neon-blue), rgba(0, 245, 255, 0.8));
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            color: white;
            font-family: 'Orbitron', cursive;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .error-btn:hover {
            background: linear-gradient(145deg, rgba(0, 245, 255, 0.9), var(--neon-blue));
            box-shadow: 0 0 20px rgba(0, 245, 255, 0.5);
        }

        .hidden { display: none !important; }

        /* Performance optimizations */
        .cartridge-item, .control-btn, .tab-btn {
            will-change: transform;
        }

        /* Enhanced hover effects */
        .interactive:hover {
            transform: translateZ(10px);
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg"></div>
    
    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>

    <div class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="text-center py-8 relative z-10">
            <h1 class="retro-title mb-4">
                Retro Rewind<sup class="text-2xl align-top opacity-60">™</sup>
            </h1>
            <div class="status-display max-w-lg mx-auto">
                <div class="status-text" id="status-text">
                    Ready to experience gaming history
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="flex justify-center mb-8 px-4">
            <div class="tab-container">
                <button class="tab-btn active" data-tab="nes-tab">
                    <span>NES</span>
                </button>
                <button class="tab-btn" data-tab="n64-tab">
                    <span>N64</span>
                </button>
                <button class="tab-btn" data-tab="credits-tab">
                    <span>Credits</span>
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 px-4 pb-8">
            <!-- NES Tab -->
            <div id="nes-tab" class="tab-content active">
                <div class="tv-container">
                    <div class="tv-frame glass">
                        <div class="screen-bezel">
                            <div class="screen-display">
                                <canvas id="nes-canvas" class="game-canvas" width="256" height="240"></canvas>
                                <div id="nes-overlay" class="screen-overlay" style="background-image: url('https://raw.githubusercontent.com/oxyisbad222/retrorewind/main/assets/Splash/NES.png');"></div>
                                <div class="crt-effects"></div>
                            </div>
                        </div>
                        
                        <!-- Power System -->
                        <div class="power-system">
                            <div class="power-indicator" id="nes-power-light"></div>
                            <button class="power-button" id="nes-power-btn">
                                <span id="nes-power-text">POWER</span>
                            </button>
                            <div class="flex items-center gap-2 ml-4">
                                <button class="control-btn system-btn" id="controller-toggle">
                                    Controller: <span id="controller-status">ON</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Game Library -->
                <div class="game-library">
                    <div class="library-header">
                        <h2 class="library-title">NES Game Library</h2>
                        <div class="text-sm opacity-60">
                            <span id="nes-game-count">18</span> Games Available
                        </div>
                    </div>
                    <div class="cartridge-grid" id="nes-cartridge-grid">
                        <!-- Games will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- N64 Tab -->
            <div id="n64-tab" class="tab-content">
                <div class="tv-container">
                    <div class="tv-frame glass">
                        <div class="screen-bezel">
                            <div class="screen-display">
                                <canvas id="n64-canvas" class="game-canvas" width="640" height="480"></canvas>
                                <div id="n64-overlay" class="screen-overlay" style="background-image: url('https://raw.githubusercontent.com/oxyisbad222/retrorewind/main/assets/Splash/N64.png');"></div>
                                <div class="crt-effects"></div>
                            </div>
                        </div>
                        
                        <!-- Power System -->
                        <div class="power-system">
                            <div class="power-indicator" id="n64-power-light"></div>
                            <button class="power-button" id="n64-power-btn">
                                <span id="n64-power-text">POWER</span>
                            </button>
                            <div class="flex items-center gap-2 ml-4">
                                <span class="px-3 py-1 bg-blue-900 text-blue-300 rounded-full text-xs font-bold">
                                    BETA
                                </span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Game Library -->
                <div class="game-library">
                    <div class="library-header">
                        <h2 class="library-title">N64 Game Library</h2>
                        <div class="text-sm opacity-60">
                            <span id="n64-game-count">5</span> Games Available
                        </div>
                    </div>
                    <div class="cartridge-grid" id="n64-cartridge-grid">
                        <!-- Games will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Credits Tab -->
            <div id="credits-tab" class="tab-content">
                <div class="credits-container">
                    <div class="credits-card">
                        <div class="credits-title">
                            Retro Rewind
                        </div>
                        <div class="text-lg mb-8 opacity-90">
                            Experience gaming history in your browser
                        </div>
                        
                        <div class="credits-list">
                            <div class="credit-item">
                                <strong>Lead Developer & Design:</strong> SkyeDev
                            </div>
                            <div class="credit-item">
                                <strong>NES Emulation:</strong> JSNES
                            </div>
                            <div class="credit-item">
                                <strong>N64 Emulation:</strong> N64Wasm by nbarkhina
                            </div>
                            <div class="credit-item">
                                <strong>Game Assets:</strong> Community Contributors
                            </div>
                            <div class="credit-item">
                                <strong>Visual Design:</strong> Modern Retro-Futurism
                            </div>
                        </div>

                        <div class="text-center">
                            <p class="mb-4 text-lg">
                                Thank you for playing!<br>
                                Enjoy the nostalgia and rewind time.
                            </p>
                            <div class="credits-heart">❤️</div>
                            <div class="text-sm opacity-60 mt-4">
                                Built with passion for retro gaming
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Mobile Controller for NES -->
        <div class="mobile-controller" id="nes-mobile-controller">
            <div class="controller-layout">
                <!-- D-Pad -->
                <div class="d-pad">
                    <div class="d-pad-center"></div>
                    <button class="control-btn d-pad-btn d-pad-up" data-key="38">▲</button>
                    <button class="control-btn d-pad-btn d-pad-down" data-key="40">▼</button>
                    <button class="control-btn d-pad-btn d-pad-left" data-key="37">◄</button>
                    <button class="control-btn d-pad-btn d-pad-right" data-key="39">►</button>
                </div>

                <!-- System Buttons -->
                <div class="system-buttons">
                    <button class="control-btn system-btn" data-key="16">SELECT</button>
                    <button class="control-btn system-btn" data-key="13">START</button>
                </div>

                <!-- Face Buttons -->
                <div class="face-buttons">
                    <button class="control-btn face-btn" data-key="90">B</button>
                    <button class="control-btn face-btn" data-key="88">A</button>
                </div>
            </div>
        </div>

        <!-- Mobile Controller for N64 -->
        <div class="mobile-controller" id="n64-mobile-controller">
            <div class="controller-layout">
                <!-- D-Pad -->
                <div class="d-pad">
                    <div class="d-pad-center"></div>
                    <button class="control-btn d-pad-btn d-pad-up" data-key="ArrowUp">▲</button>
                    <button class="control-btn d-pad-btn d-pad-down" data-key="ArrowDown">▼</button>
                    <button class="control-btn d-pad-btn d-pad-left" data-key="ArrowLeft">◄</button>
                    <button class="control-btn d-pad-btn d-pad-right" data-key="ArrowRight">►</button>
                </div>

                <!-- System Buttons -->
                <div class="system-buttons">
                    <button class="control-btn system-btn" data-key="Enter">START</button>
                    <button class="control-btn system-btn" data-key="KeyZ">Z</button>
                </div>

                <!-- Face Buttons -->
                <div class="face-buttons">
                    <button class="control-btn face-btn" data-key="KeyB">B</button>
                    <button class="control-btn face-btn" data-key="KeyA">A</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div class="error-modal hidden" id="error-modal">
        <div class="error-content">
            <div class="error-title">System Error</div>
            <div class="error-message" id="error-message">
                An error occurred while loading the game.
            </div>
            <button class="error-btn" id="error-close">OK</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://unpkg.com/jsnes/dist/jsnes.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/n64wasm@1.0.0/dist/n64wasm.min.js"></script>
    <script>
        // Enhanced Retro Rewind Application
        class RetroRewindApp {
            constructor() {
                this.GITHUB_BASE = 'https://raw.githubusercontent.com/oxyisbad222/retrorewind/main/';
                this.ASSET_BASE = this.GITHUB_BASE + 'assets/';
                this.ROM_BASE = this.ASSET_BASE + 'games/';
                this.COVER_BASE = this.ASSET_BASE + 'covers/';

                // Game databases
                this.NES_GAMES = [
                    { id: 'Super Mario Bros. (USA)', name: 'Super Mario Bros.', rom: 'supermariobrothers.nes' },
                    { id: 'Mega Man 2 (USA)', name: 'Mega Man 2', rom: 'megaman2.nes' },
                    { id: "Mike Tyson's Punch-Out!!", name: "Mike Tyson's Punch-Out!!", rom: "miketysonspunchout.nes" },
                    { id: 'Contra (USA)', name: 'Contra', rom: 'contra.nes' },
                    { id: 'Battletoads (USA)', name: 'Battletoads', rom: 'battletoads.nes'},
                    { id: 'Super Mario Bros. 3 (USA)', name: 'Super Mario Bros. 3', rom: 'supermariobrothers3.nes'},
                    { id: 'Teenage Mutant Ninja Turtles (USA)', name: 'TMNT', rom: 'teenagemutantninjaturtles.nes'},
                    { id: 'Kung Fu', name: 'Kung Fu', rom: 'kungfu.nes'},
                    { id: 'Ms. Pac-Man', name: 'Ms. Pac-Man', rom: 'mspacman.nes'},
                    { id: 'Pro Wrestling', name: 'Pro Wrestling', rom: 'prowrestling.nes'},
                    { id: 'Super Mario Bros. 2', name: 'Super Mario Bros. 2', rom: 'supermariobrothers2.nes'},
                    { id: 'Super Spike V\'Ball', name: 'Super Spike V\'Ball', rom: 'superspikev-ballworldcup.nes'},
                    { id: 'Tag Team Pro Wrestling', name: 'Tag Team Pro Wrestling', rom: 'tagteamprowrestling.nes'},
                    { id: 'Tecmo Super Bowl', name: 'Tecmo Super Bowl', rom: 'tecmosuperbowl.nes'},
                    { id: 'TMNT 2', name: 'TMNT 2', rom: 'teenagemutantninjaturtles2.nes'},
                    { id: 'TMNT 3', name: 'TMNT 3', rom: 'teenagemutantninjaturtles3.nes'},
                    { id: 'WCW Wrestling', name: 'WCW Wrestling', rom: 'wcwworldchampionshipwrestling.nes'},
                    { id: 'WWF Wrestlemania', name: 'WWF Wrestlemania', rom: 'wrestlemania.nes'}
                ];

                this.N64_GAMES = [
                    { id: 'GoldenEye 007', name: 'GoldenEye 007', rom: 'GoldenEye 007 (USA).z64' },
                    { id: 'Mario Kart 64', name: 'Mario Kart 64', rom: 'Mario Kart 64 (USA).z64' },
                    { id: 'Paper Mario', name: 'Paper Mario', rom: 'Paper Mario (USA).z64' },
                    { id: 'Super Mario 64', name: 'Super Mario 64', rom: 'Super Mario 64 (USA).z64' },
                    { id: 'WWF No Mercy Plus', name: 'WWF No Mercy Plus', rom: 'WWF No Mercy Plus (v2.1).z64' }
                ];

                // NES Key mapping
                this.NES_KEY_MAP = {
                    38: 'UP', 40: 'DOWN', 37: 'LEFT', 39: 'RIGHT',
                    88: 'A', 90: 'B', 16: 'SELECT', 13: 'START'
                };

                // State management
                this.state = {
                    currentSystem: 'nes',
                    nes: {
                        emulator: null,
                        powered: false,
                        currentGame: null,
                        audioCtx: null,
                        audioNode: null,
                        animationFrame: null
                    },
                    n64: {
                        emulator: null,
                        powered: false,
                        currentGame: null,
                        animationFrame: null
                    },
                    controllerEnabled: true
                };

                this.init();
            }

            async init() {
                await this.createParticles();
                this.setupTabs();
                this.populateGameLibraries();
                this.setupEventListeners();
                this.setupGamepadPolling();
                this.updateStatus('Ready to experience gaming history');
            }

            // Particle system
            async createParticles() {
                const particlesContainer = document.getElementById('particles');
                const particleCount = window.innerWidth < 768 ? 20 : 40;

                for (let i = 0; i < particleCount; i++) {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 6 + 's';
                    particle.style.animationDuration = (6 + Math.random() * 4) + 's';
                    particlesContainer.appendChild(particle);
                }
            }

            // Tab system
            setupTabs() {
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const tabId = btn.dataset.tab;
                        this.switchTab(tabId);
                    });
                });
            }

            switchTab(tabId) {
                // Update tab buttons
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.tab === tabId);
                });

                // Update tab content
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.toggle('active', content.id === tabId);
                });

                // Update mobile controller visibility
                this.updateMobileControllerVisibility(tabId);

                // Update current system
                if (tabId === 'nes-tab') this.state.currentSystem = 'nes';
                else if (tabId === 'n64-tab') this.state.currentSystem = 'n64';
            }

            updateMobileControllerVisibility(tabId) {
                const nesController = document.getElementById('nes-mobile-controller');
                const n64Controller = document.getElementById('n64-mobile-controller');
                
                nesController.style.display = 'none';
                n64Controller.style.display = 'none';
                
                if (this.state.controllerEnabled && window.innerWidth < 1024) {
                    if (tabId === 'nes-tab') nesController.style.display = 'flex';
                    else if (tabId === 'n64-tab') n64Controller.style.display = 'flex';
                }
            }

            // Game library population
            populateGameLibraries() {
                this.populateNESLibrary();
                this.populateN64Library();
            }

            populateNESLibrary() {
                const container = document.getElementById('nes-cartridge-grid');
                container.innerHTML = '';

                this.NES_GAMES.forEach(game => {
                    const cartridge = this.createCartridgeElement(game, 'nes');
                    container.appendChild(cartridge);
                });
            }

            populateN64Library() {
                const container = document.getElementById('n64-cartridge-grid');
                container.innerHTML = '';

                this.N64_GAMES.forEach(game => {
                    const cartridge = this.createCartridgeElement(game, 'n64');
                    container.appendChild(cartridge);
                });
            }

            createCartridgeElement(game, system) {
                const cartridge = document.createElement('div');
                cartridge.className = 'cartridge-item interactive';
                cartridge.dataset.gameId = game.id;
                cartridge.dataset.system = system;

                const cartridgeType = system === 'nes' ? 'Front' : 'N64Front';

                cartridge.innerHTML = `
                    <div class="cartridge-wrapper">
                        <img src="${this.ASSET_BASE}Cartridge/${cartridgeType}.png" 
                             alt="${system.toUpperCase()} Cartridge" 
                             class="cartridge-image">
                        <img src="${this.COVER_BASE}${game.id}.png" 
                             alt="${game.name}" 
                             class="game-cover"
                             onerror="this.src='https://placehold.co/120x80/222222/FFFFFF?text=${encodeURIComponent(game.name)}'">
                        <div class="cartridge-title">${game.name}</div>
                    </div>
                `;

                cartridge.addEventListener('click', () => {
                    this.loadGame(game, system);
                });

                return cartridge;
            }

            // Event listeners
            setupEventListeners() {
                // Power buttons
                document.getElementById('nes-power-btn').addEventListener('click', () => {
                    this.togglePower('nes');
                });

                document.getElementById('n64-power-btn').addEventListener('click', () => {
                    this.togglePower('n64');
                });

                // Controller toggle
                document.getElementById('controller-toggle').addEventListener('click', () => {
                    this.toggleController();
                });

                // Error modal
                document.getElementById('error-close').addEventListener('click', () => {
                    document.getElementById('error-modal').classList.add('hidden');
                });

                // Keyboard controls
                this.setupKeyboardControls();
                this.setupMobileControls();
            }

            setupKeyboardControls() {
                document.addEventListener('keydown', (e) => {
                    this.handleKeyInput(e.keyCode, true);
                });

                document.addEventListener('keyup', (e) => {
                    this.handleKeyInput(e.keyCode, false);
                });
            }

            setupMobileControls() {
                // NES Controller
                document.querySelectorAll('#nes-mobile-controller .control-btn').forEach(btn => {
                    const keyCode = parseInt(btn.dataset.key);
                    
                    btn.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        btn.classList.add('active');
                        this.handleKeyInput(keyCode, true);
                    });

                    btn.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        btn.classList.remove('active');
                        this.handleKeyInput(keyCode, false);
                    });
                });

                // N64 Controller
                document.querySelectorAll('#n64-mobile-controller .control-btn').forEach(btn => {
                    const key = btn.dataset.key;
                    
                    btn.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        btn.classList.add('active');
                        this.handleN64Input(key, true);
                    });

                    btn.addEventListener('touchend', (e) => {
                        e.preventDefault();
                        btn.classList.remove('active');
                        this.handleN64Input(key, false);
                    });
                });
            }

            // Input handling
            handleKeyInput(keyCode, pressed) {
                if (this.state.currentSystem === 'nes' && this.state.nes.powered && this.state.nes.emulator) {
                    const nesKey = this.NES_KEY_MAP[keyCode];
                    if (nesKey) {
                        const jsnesButton = this.getJSNESButton(nesKey);
                        if (pressed) {
                            this.state.nes.emulator.buttonDown(1, jsnesButton);
                        } else {
                            this.state.nes.emulator.buttonUp(1, jsnesButton);
                        }
                    }
                }
            }

            handleN64Input(key, pressed) {
                if (this.state.currentSystem === 'n64' && this.state.n64.powered && this.state.n64.emulator) {
                    const n64Key = this.mapN64Key(key);
                    if (n64Key && this.state.n64.emulator.setButton) {
                        this.state.n64.emulator.setButton(0, n64Key, pressed);
                    }
                }
            }

            getJSNESButton(key) {
                const buttonMap = {
                    'UP': jsnes.Controller.BUTTON_UP,
                    'DOWN': jsnes.Controller.BUTTON_DOWN,
                    'LEFT': jsnes.Controller.BUTTON_LEFT,
                    'RIGHT': jsnes.Controller.BUTTON_RIGHT,
                    'A': jsnes.Controller.BUTTON_A,
                    'B': jsnes.Controller.BUTTON_B,
                    'SELECT': jsnes.Controller.BUTTON_SELECT,
                    'START': jsnes.Controller.BUTTON_START
                };
                return buttonMap[key];
            }

            mapN64Key(key) {
                const keyMap = {
                    'ArrowUp': 'DPAD_UP',
                    'ArrowDown': 'DPAD_DOWN',
                    'ArrowLeft': 'DPAD_LEFT',
                    'ArrowRight': 'DPAD_RIGHT',
                    'KeyA': 'A',
                    'KeyB': 'B',
                    'Enter': 'START',
                    'KeyZ': 'Z'
                };
                return keyMap[key];
            }

            // Game loading
            async loadGame(game, system) {
                if (system === 'nes') {
                    await this.loadNESGame(game);
                } else if (system === 'n64') {
                    await this.loadN64Game(game);
                }
            }

            async loadNESGame(game) {
                try {
                    this.updateStatus(`<div class="loading-spinner"></div>Loading ${game.name}...`);
                    
                    // Update selection
                    this.updateGameSelection(game.id, 'nes');
                    
                    // Stop current game
                    this.powerOff('nes');
                    
                    // Initialize audio
                    await this.initNESAudio();
                    
                    // Load ROM
                    const romData = await this.fetchROM(game.rom);
                    
                    // Create emulator
                    const canvas = document.getElementById('nes-canvas');
                    const ctx = canvas.getContext('2d');
                    const imageData = ctx.createImageData(256, 240);
                    const buffer32 = new Uint32Array(imageData.data.buffer);
                    
                    this.state.nes.emulator = new jsnes.NES({
                        onFrame: (frameBuffer) => {
                            for (let i = 0; i < frameBuffer.length; i++) {
                                buffer32[i] = 0xFF000000 | frameBuffer[i];
                            }
                            ctx.putImageData(imageData, 0, 0);
                        },
                        sampleRate: this.state.nes.audioCtx?.sampleRate || 44100
                    });
                    
                    this.state.nes.emulator.loadROM(romData);
                    this.state.nes.currentGame = game;
                    
                    // Hide overlay and power on
                    document.getElementById('nes-overlay').style.opacity = '0';
                    this.powerOn('nes');
                    
                } catch (error) {
                    console.error('Failed to load NES game:', error);
                    this.showError(`Failed to load ${game.name}. Please try again.`);
                }
            }

            async loadN64Game(game) {
                try {
                    this.updateStatus(`<div class="loading-spinner"></div>Loading ${game.name}...`);
                    
                    // Update selection
                    this.updateGameSelection(game.id, 'n64');
                    
                    // Stop current game
                    this.powerOff('n64');
                    
                    if (!window.N64Wasm) {
                        throw new Error('N64Wasm not available');
                    }
                    
                    // Load ROM
                    const romBuffer = await this.fetchROMBuffer(game.rom);
                    
                    // Initialize emulator if needed
                    if (!this.state.n64.emulator) {
                        const canvas = document.getElementById('n64-canvas');
                        this.state.n64.emulator = await N64Wasm({
                            canvas: canvas,
                            onReady: () => {
                                console.log('N64 emulator ready');
                            },
                            onError: (msg) => {
                                this.showError(`N64 Error: ${msg}`);
                            }
                        });
                    }
                    
                    // Reset and load ROM
                    this.state.n64.emulator.reset();
                    await this.state.n64.emulator.loadROM(romBuffer);
                    this.state.n64.currentGame = game;
                    
                    // Hide overlay and power on
                    document.getElementById('n64-overlay').style.opacity = '0';
                    this.powerOn('n64');
                    
                } catch (error) {
                    console.error('Failed to load N64 game:', error);
                    this.showError(`Failed to load ${game.name}. Please try again.`);
                }
            }

            // ROM fetching
            async fetchROM(romFile) {
                const response = await fetch(this.ROM_BASE + romFile);
                if (!response.ok) throw new Error(`ROM not found: ${romFile}`);
                
                const arrayBuffer = await response.arrayBuffer();
                const bytes = new Uint8Array(arrayBuffer);
                let romData = '';
                for (let i = 0; i < bytes.length; i++) {
                    romData += String.fromCharCode(bytes[i]);
                }
                return romData;
            }

            async fetchROMBuffer(romFile) {
                const response = await fetch(this.ROM_BASE + romFile);
                if (!response.ok) throw new Error(`ROM not found: ${romFile}`);
                return await response.arrayBuffer();
            }

            // Audio initialization
            async initNESAudio() {
                if (this.state.nes.audioCtx && this.state.nes.audioNode) return;
                
                try {
                    this.state.nes.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                    this.state.nes.audioNode = this.state.nes.audioCtx.createScriptProcessor(2048, 1, 1);
                    
                    this.state.nes.audioNode.onaudioprocess = (e) => {
                        if (!this.state.nes.powered || !this.state.nes.emulator) {
                            const output = e.outputBuffer.getChannelData(0);
                            for (let i = 0; i < output.length; i++) output[i] = 0;
                            return;
                        }
                        
                        const buffer = e.outputBuffer.getChannelData(0);
                        this.state.nes.emulator.audio.getSamples(buffer, buffer.length);
                    };
                    
                    this.state.nes.audioNode.connect(this.state.nes.audioCtx.destination);
                } catch (error) {
                    console.warn('Audio initialization failed:', error);
                }
            }

            // Power management
            togglePower(system) {
                if (this.state[system].powered) {
                    this.powerOff(system);
                } else {
                    this.powerOn(system);
                }
            }

            powerOn(system) {
                if (!this.state[system].currentGame) {
                    this.updateStatus('Please select a game first');
                    return;
                }
                
                this.state[system].powered = true;
                
                // Update UI
                const powerLight = document.getElementById(`${system}-power-light`);
                const powerText = document.getElementById(`${system}-power-text`);
                
                powerLight.classList.add('on');
                powerText.textContent = 'ON';
                
                // Resume audio
                if (system === 'nes' && this.state.nes.audioCtx?.state === 'suspended') {
                    this.state.nes.audioCtx.resume();
                }
                
                // Start game loop
                if (system === 'nes') {
                    this.startNESGameLoop();
                } else if (system === 'n64') {
                    this.startN64GameLoop();
                }
                
                this.updateStatus(`Now Playing: ${this.state[system].currentGame.name}`);
            }

            powerOff(system) {
                this.state[system].powered = false;
                
                // Stop game loop
                if (this.state[system].animationFrame) {
                    cancelAnimationFrame(this.state[system].animationFrame);
                    this.state[system].animationFrame = null;
                }
                
                // Update UI
                const powerLight = document.getElementById(`${system}-power-light`);
                const powerText = document.getElementById(`${system}-power-text`);
                const overlay = document.getElementById(`${system}-overlay`);
                
                powerLight.classList.remove('on');
                powerText.textContent = 'POWER';
                overlay.style.opacity = '1';
                
                // Suspend audio
                if (system === 'nes' && this.state.nes.audioCtx?.state === 'running') {
                    this.state.nes.audioCtx.suspend();
                }
                
                // Pause N64 emulator
                if (system === 'n64' && this.state.n64.emulator?.pause) {
                    this.state.n64.emulator.pause();
                }
                
                this.updateStatus(`${system.toUpperCase()} system powered off`);
            }

            // Game loops
            startNESGameLoop() {
                const gameLoop = () => {
                    if (!this.state.nes.powered) return;
                    
                    if (this.state.nes.emulator) {
                        this.state.nes.emulator.frame();
                    }
                    
                    this.state.nes.animationFrame = requestAnimationFrame(gameLoop);
                };
                gameLoop();
            }

            startN64GameLoop() {
                const gameLoop = () => {
                    if (!this.state.n64.powered) return;
                    
                    if (this.state.n64.emulator?._mainLoop) {
                        this.state.n64.emulator._mainLoop();
                    }
                    
                    this.state.n64.animationFrame = requestAnimationFrame(gameLoop);
                };
                gameLoop();
            }

            // UI Updates
            updateGameSelection(gameId, system) {
                // Clear previous selections
                document.querySelectorAll(`.cartridge-item[data-system="${system}"]`).forEach(item => {
                    item.classList.remove('selected');
                });
                
                // Add selection to current game
                const selectedItem = document.querySelector(`.cartridge-item[data-game-id="${gameId}"][data-system="${system}"]`);
                if (selectedItem) {
                    selectedItem.classList.add('selected');
                }
            }

            updateStatus(message) {
                const statusElement = document.getElementById('status-text');
                statusElement.innerHTML = message;
            }

            showError(message) {
                const modal = document.getElementById('error-modal');
                const messageElement = document.getElementById('error-message');
                messageElement.textContent = message;
                modal.classList.remove('hidden');
            }

            // Controller management
            toggleController() {
                this.state.controllerEnabled = !this.state.controllerEnabled;
                
                const toggleBtn = document.getElementById('controller-toggle');
                const statusSpan = document.getElementById('controller-status');
                
                statusSpan.textContent = this.state.controllerEnabled ? 'ON' : 'OFF';
                
                // Update mobile controller visibility
                this.updateMobileControllerVisibility(
                    document.querySelector('.tab-content.active').id
                );
            }

            // Gamepad support
            setupGamepadPolling() {
                let prevGamepadState = {};
                
                const pollGamepad = () => {
                    const gamepads = navigator.getGamepads ? navigator.getGamepads() : [];
                    const gamepad = gamepads[0];
                    
                    if (gamepad && this.state.currentSystem === 'nes' && this.state.nes.powered) {
                        this.handleNESGamepad(gamepad, prevGamepadState);
                    } else if (gamepad && this.state.currentSystem === 'n64' && this.state.n64.powered) {
                        this.handleN64Gamepad(gamepad, prevGamepadState);
                    }
                    
                    requestAnimationFrame(pollGamepad);
                };
                
                pollGamepad();
            }

            handleNESGamepad(gamepad, prevState) {
                const buttonMap = [
                    { btn: 0, key: 88 },   // A -> A
                    { btn: 1, key: 90 },   // B -> B
                    { btn: 8, key: 16 },   // Select
                    { btn: 9, key: 13 },   // Start
                    { btn: 12, key: 38 },  // Up
                    { btn: 13, key: 40 },  // Down
                    { btn: 14, key: 37 },  // Left
                    { btn: 15, key: 39 }   // Right
                ];

                buttonMap.forEach(({btn, key}) => {
                    const pressed = gamepad.buttons[btn]?.pressed || false;
                    const wasPressed = prevState[btn] || false;
                    
                    if (pressed !== wasPressed) {
                        this.handleKeyInput(key, pressed);
                        prevState[btn] = pressed;
                    }
                });
            }

            handleN64Gamepad(gamepad, prevState) {
                const buttonMap = [
                    { btn: 0, key: 'KeyA' },      // A
                    { btn: 1, key: 'KeyB' },      // B
                    { btn: 9, key: 'Enter' },     // Start
                    { btn: 6, key: 'KeyZ' },      // Z (L2)
                    { btn: 12, key: 'ArrowUp' },  // Up
                    { btn: 13, key: 'ArrowDown' }, // Down
                    { btn: 14, key: 'ArrowLeft' }, // Left
                    { btn: 15, key: 'ArrowRight' } // Right
                ];

                buttonMap.forEach(({btn, key}) => {
                    const pressed = gamepad.buttons[btn]?.pressed || false;
                    const wasPressed = prevState[btn] || false;
                    
                    if (pressed !== wasPressed) {
                        this.handleN64Input(key, pressed);
                        prevState[btn] = pressed;
                    }
                });

                // Analog stick for N64
                if (gamepad.axes && gamepad.axes.length >= 2 && this.state.n64.emulator?.setAnalog) {
                    const x = Math.round(gamepad.axes[0] * 80);
                    const y = Math.round(gamepad.axes[1] * 80);
                    this.state.n64.emulator.setAnalog(0, x, y);
                }
            }
        }

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            window.retroRewind = new RetroRewindApp();
        });

        // Performance optimizations
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                // Pause audio when tab is hidden
                if (window.retroRewind?.state.nes.audioCtx?.state === 'running') {
                    window.retroRewind.state.nes.audioCtx.suspend();
                }
            } else {
                // Resume audio when tab is visible
                if (window.retroRewind?.state.nes.powered && window.retroRewind?.state.nes.audioCtx?.state === 'suspended') {
                    window.retroRewind.state.nes.audioCtx.resume();
                }
            }
        });

        // Handle window resize
        window.addEventListener('resize', () => {
            if (window.retroRewind) {
                const currentTab = document.querySelector('.tab-content.active').id;
                window.retroRewind.updateMobileControllerVisibility(currentTab);
            }
        });

        // Smooth scrolling for better UX
        document.documentElement.style.scrollBehavior = 'smooth';

        // Enhanced loading states
        window.addEventListener('load', () => {
            document.body.classList.add('loaded');
            
            // Add subtle animation delays for better perceived performance
            setTimeout(() => {
                document.querySelectorAll('.cartridge-item').forEach((item, index) => {
                    item.style.animationDelay = (index * 50) + 'ms';
                    item.classList.add('animate-fade-in');
                });
            }, 500);
        });

        // Add CSS for fade-in animation
        const style = document.createElement('style');
        style.textContent = `
            .animate-fade-in {
                animation: fadeInUp 0.6s ease-out forwards;
                opacity: 0;
                transform: translateY(20px);
            }
            
            @keyframes fadeInUp {
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            .loaded .animate-fade-in {
                opacity: 1;
                transform: translateY(0);
            }
        `;
        document.head.appendChild(style);

        // Touch gesture improvements for mobile
        if ('ontouchstart' in window) {
            document.addEventListener('touchstart', function() {}, {passive: true});
            
            // Prevent zoom on double tap
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }

        // Add haptic feedback for supported devices
        function vibrate(pattern = 10) {
            if ('vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        }

        // Enhanced error handling
        window.addEventListener('error', (event) => {
            console.error('Global error:', event.error);
            if (window.retroRewind) {
                window.retroRewind.showError('An unexpected error occurred. Please refresh the page.');
            }
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('Unhandled promise rejection:', event.reason);
            if (window.retroRewind) {
                window.retroRewind.showError('Failed to load game resources. Please check your connection.');
            }
        });
    </script>
</body>
</html>
                